"use client";
import Head from "next/head";

import { useRouter } from "next/router";
import { useEffect, useState } from "react";
import Layout from "../../../../components/Layout";
import { api } from "../../../../utils/api";

export interface IRestaurantData {
  cityName: string;
  cuisine: string;
  email: string;
  hoursInterval: string;
  id: number;
  phone: string;
  name: string;
  stateName: string;
  website: string;
  zipCode: string;
  address: string;
}

const SingleRestaurant = () => {
  const router = useRouter();
  const createRestaurant = api.restaurant.createRestaurant.useMutation();
  const { restaurantId } = router.query;
  const [singleResraurantData, setSingleRestaurantData] =
    useState<IRestaurantData | null>(null);
  useEffect(() => {
    const restaurantJSON: string | null =
      localStorage?.getItem("restaurants") || null;
    // const restaurantJSON = `{ "empty": "yes" }`;

    const newSngleResraurantData: IRestaurantData | null = JSON.parse(
      restaurantJSON ? restaurantJSON : ""
    )?.find((elem: IRestaurantData) => {
      return elem.id === Number(restaurantId);
    });
    setSingleRestaurantData(newSngleResraurantData);
  }, []);

  const handleSaveRestaurantData = (
    e: React.SyntheticEvent<HTMLButtonElement>
  ) => {
    e.preventDefault();
    createRestaurant.mutate(
      {
        name: singleResraurantData?.name ? singleResraurantData?.name : "",
        cityName: singleResraurantData?.cityName
          ? singleResraurantData?.cityName
          : "",
        address: singleResraurantData?.address
          ? singleResraurantData?.address
          : "",

        stateName: singleResraurantData?.stateName
          ? singleResraurantData?.stateName
          : "",
        zipCode: singleResraurantData?.zipCode
          ? singleResraurantData?.zipCode
          : "",
        email: singleResraurantData?.email ? singleResraurantData?.email : "",
        phone: singleResraurantData?.phone ? singleResraurantData?.phone : "",
        website: singleResraurantData?.website
          ? singleResraurantData?.website
          : "",
        hoursInterval: singleResraurantData?.hoursInterval
          ? singleResraurantData?.hoursInterval
          : "",
        cuisineType: singleResraurantData?.cuisine
          ? singleResraurantData?.cuisine
          : "",
      },
      {
        onSuccess() {
          console.log("restaurant added to db");
        },
      }
    );
  };

  return (
    <>
      <Head>
        <title>Foodly</title>
        <meta name="description" content="Generated by create-t3-app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Layout>
        <div>
          <div className="flex flex-col">
            <span className="text-lg">single restaurant page</span>
            {/* <div>{singleResraurantData?.name}</div>
            <div>{singleResraurantData?.cuisine}</div>
            <button onClick={handleSaveRestaurantData}>add to db</button> */}
          </div>
        </div>
      </Layout>
    </>
  );
};

export default SingleRestaurant;
